#!/usr/bin/env bash
#
# Run all dotfiles installers.

set -e

cd "$(dirname $0)"/..

# -----------------------------------------------------------
# 1. å®‰è£æ ¸å¿ƒè»Ÿé«” (Core Software)
# -----------------------------------------------------------
echo "â€º brew bundle (Core Software)"
brew bundle --file="Brewfile"

# -----------------------------------------------------------
# 2. å®‰è£å­—é«” (Fonts) - ç¨ç«‹è™•ç†
# -----------------------------------------------------------
# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œä¸¦ä½¿ç”¨ || true å…è¨±å¤±æ•—ç¹¼çºŒ (å­—é«”ä¸‹è¼‰å¸¸é€¾æ™‚)
if [ -f "Brewfile.fonts" ]; then
    echo "â€º brew bundle (Fonts)"
    brew bundle --file="Brewfile.fonts" || true
else
    echo "â€º Warning: Brewfile.fonts not found, skipping fonts."
fi

# -----------------------------------------------------------
# 3. å…¶ä»–ç‰¹å®šå®‰è£èˆ‡è¨­å®š
# -----------------------------------------------------------
# Yabai Window Manager
echo "â€º Installing Yabai..."
brew install koekeishiya/formulae/yabai
yabai --start-service

# -----------------------------------------------------------
# 4. åŸ·è¡Œå…¶ä»–å­å®‰è£è…³æœ¬
# -----------------------------------------------------------
# ç¢ºä¿ç›®æ¨™ç›®éŒ„å­˜åœ¨
mkdir -p "$HOME/.config/lazygit"

# å‚™ä»½èˆŠçš„ (å¦‚æœå­˜åœ¨ä¸”ä¸æ˜¯é€£çµ)
if [ -f "$HOME/.config/lazygit/config.yml" ] && [ ! -L "$HOME/.config/lazygit/config.yml" ]; then
    mv "$HOME/.config/lazygit/config.yml" "$HOME/.config/lazygit/config.yml.bak"
fi

# å»ºç«‹é€£çµ
ln -sf "$HOME/.dotfiles/lazygit/config.yml" "$HOME/.config/lazygit/config.yml"

echo "ğŸ”— Lazygit config linked!"


# åŒæ„ Xcode æˆæ¬Š (éœ€è¦ sudo å¯†ç¢¼)
echo "â€º Accepting Xcode license..."
sudo xcodebuild -license accept || true

# å°‹æ‰¾ä¸¦åŸ·è¡Œå…¶ä»–å­ç›®éŒ„ä¸‹çš„ install.sh
echo "â€º Running sub-installers..."
find . -name install.sh | while read installer ; do sh -c "${installer}" ; done

echo "â€º Done!"
